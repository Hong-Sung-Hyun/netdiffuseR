<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>netdiffuseR showcase: Medical Innovations • netdiffuseR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="netdiffuseR showcase: Medical Innovations">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">netdiffuseR</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.19.999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/analyzing-medical-innovation-data.html">netdiffuseR showcase: Medical Innovations</a>
    </li>
    <li>
      <a href="../articles/introduction-to-netdiffuser.html">Simulating diffusion networks: Using the `rdiffnet` function</a>
    </li>
    <li>
      <a href="../articles/not-lost-in-translation-importing-and-exporting-graphs.html">Not-Lost in translation: Getting diffusion data into netdiffuseR</a>
    </li>
    <li>
      <a href="../articles/time_discount_suscep_infect.html">Time Discounted Infection and Susceptibility</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/USCCANA/netdiffuseR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>netdiffuseR showcase: Medical Innovations</h1>
                        <h4 class="author">George G. Vega Yon</h4>
            
            <h4 class="date">February 24, 2016</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/USCCANA/netdiffuseR/blob/master/vignettes/analyzing-medical-innovation-data.Rmd"><code>vignettes/analyzing-medical-innovation-data.Rmd</code></a></small>
      <div class="hidden name"><code>analyzing-medical-innovation-data.Rmd</code></div>

    </div>

    
    
<div id="data-preprocessing" class="section level1">
<h1 class="hasAnchor">
<a href="#data-preprocessing" class="anchor"></a>Data preprocessing</h1>
<p>Loading the raw dataset from the package<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(netdiffuseR)</code></pre></div>
<pre><code>## 
## Attaching package: 'netdiffuseR'</code></pre>
<pre><code>## The following object is masked from 'package:base':
## 
##     %*%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(medInnovations)</code></pre></div>
<p>Now that we have the data in R, we can start working with it, in particular, we want to do the following things:</p>
<ul>
<li>Create a unique id for each individual in the network.</li>
<li>Remove unsurveyed individuals (we don’t have additional covariates for them).</li>
<li>Reshaping the data to long format (so we can use it as a panel), and furthermore, as an edgelist.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Creating unique ids (including for the network data)</span>
othervars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"id"</span>, <span class="st">"toa"</span>, <span class="st">"city"</span>)
netvars &lt;-<span class="st"> </span><span class="kw">names</span>(medInnovations)[<span class="kw">grepl</span>(<span class="st">"^net"</span>, <span class="kw">names</span>(medInnovations))]
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">c</span>(<span class="st">"id"</span>, netvars))
  medInnovations[[i]] &lt;-<span class="st"> </span>medInnovations[[i]] <span class="op">+</span><span class="st"> </span>medInnovations<span class="op">$</span>city<span class="op">*</span><span class="dv">1000</span>

<span class="co"># Leaving unsurveyed individuals with NA</span>
surveyed &lt;-<span class="st"> </span>medInnovations<span class="op">$</span>id
<span class="cf">for</span> (i <span class="cf">in</span> netvars)
  medInnovations[[i]][<span class="kw">which</span>(<span class="op">!</span>(medInnovations[[i]] <span class="op">%in%</span><span class="st"> </span>surveyed))] &lt;-<span class="st"> </span><span class="ot">NA</span>

<span class="co"># Reshaping data (so we have an edgelist)</span>
medInnovations.long &lt;-<span class="st"> </span><span class="kw">reshape</span>(
  medInnovations[,<span class="kw">c</span>(othervars, netvars)], <span class="dt">v.names=</span> <span class="st">"net"</span>,
  <span class="dt">varying =</span> netvars,
  <span class="dt">timevar =</span> <span class="st">"level"</span>, <span class="dt">idvar=</span><span class="st">"id"</span>, <span class="dt">direction=</span><span class="st">"long"</span>)</code></pre></div>
<p>Once we have the data in long format, we can coerce it into an <code>diffnet</code> object. This is done by reading the edgelist, obtaining the times of adoption vector and applying the <code>as_diffnet</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Coersing the edgelist to an adjacency matrix. Here we are assuming that the</span>
<span class="co"># network is constant through time.</span>
graph &lt;-<span class="st"> </span><span class="kw">with</span>(
  medInnovations.long,
  <span class="kw"><a href="../reference/edgelist_to_adjmat.html">edgelist_to_adjmat</a></span>(<span class="kw">cbind</span>(id, net), <span class="dt">t=</span><span class="dv">18</span>,<span class="dt">undirected=</span><span class="ot">FALSE</span>, <span class="dt">keep.isolates =</span> <span class="ot">TRUE</span>)
)</code></pre></div>
<p>Notice that we have included <code>keep.isolates=TRUE</code>, so, if any element of our edgelist had an <code>NA</code>, <code>NULL</code> or related value, it would still be included in the adjacency matrix. This is specially important if, for example, there are isolated nodes in the data, as if we had not set <code>keep.isolates=TRUE</code> those would had been discarded.</p>
<p>Now we can create our <code>diffnet</code> object. Notice that <code>medInnovations</code> happens to be sorted in the same way as the elements in the adjacency matrix. You can check this by accessing the <code>rownames</code> and sorting <code>medInnovations</code> in that order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Just to be sure. Sorting the data!</span>
orddata &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(<span class="kw">rownames</span>(graph[[<span class="dv">1</span>]])))
medInnovations &lt;-<span class="st"> </span>medInnovations[orddata,]

<span class="co"># Creating a diffnet object</span>
diffnet &lt;-<span class="st"> </span><span class="kw"><a href="../reference/diffnet-class.html">as_diffnet</a></span>(graph, medInnovations<span class="op">$</span>toa, 
                      <span class="dt">vertex.static.attrs =</span> <span class="kw">subset</span>(medInnovations, <span class="dt">select=</span><span class="kw">c</span>(<span class="op">-</span>id, <span class="op">-</span>toa)))</code></pre></div>
<pre><code>## Warning in new_diffnet(graph, ...): Coercing -toa- into integer.</code></pre>
</div>
<div id="methods" class="section level1">
<h1 class="hasAnchor">
<a href="#methods" class="anchor"></a>Methods</h1>
<p>Once a <code>diffnet</code> object, we can apply the usual generic R functions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(diffnet, <span class="dt">t=</span>diffnet<span class="op">$</span>meta<span class="op">$</span>nper)</code></pre></div>
<p><img src="analyzing-medical-innovation-data_files/figure-html/Checking-the-methods-1.png" width="600" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diffnet</code></pre></div>
<pre><code>## Dynamic network of class -diffnet-
##  Name               : Diffusion Network
##  Behavior           : Unspecified
##  # of nodes         : 125 (1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, ...)
##  # of time periods  : 18 (1 - 18)
##  Type               : directed
##  Final prevalence   : 1.00
##  Static attributes  : city, detail, meet, coll, attend, proage, length, ... (58)
##  Dynamic attributes : -</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(diffnet)</code></pre></div>
<pre><code>## Diffusion network summary statistics
## Name     : Diffusion Network
## Behavior : Unspecified
## -----------------------------------------------------------------------------
##  Period   Adopters   Cum Adopt. (%)   Hazard Rate   Density   Moran's I (sd)  
## -------- ---------- ---------------- ------------- --------- ---------------- 
##        1         11        11 (0.09)             -      0.02  0.07 (0.03) **  
##        2          9        20 (0.16)          0.08      0.02  0.04 (0.03)     
##        3          9        29 (0.23)          0.09      0.02 -0.03 (0.03)     
##        4         11        40 (0.32)          0.11      0.02 -0.02 (0.03)     
##        5         11        51 (0.41)          0.13      0.02 -0.06 (0.03)     
##        6         11        62 (0.50)          0.15      0.02 -0.02 (0.03)     
##        7         13        75 (0.60)          0.21      0.02 -0.00 (0.03)     
##        8          7        82 (0.66)          0.14      0.02  0.01 (0.03)     
##        9          4        86 (0.69)          0.09      0.02  0.01 (0.03)     
##       10          1        87 (0.70)          0.03      0.02  0.01 (0.03)     
##       11          5        92 (0.74)          0.13      0.02  0.02 (0.03)     
##       12          3        95 (0.76)          0.09      0.02  0.02 (0.03)     
##       13          3        98 (0.78)          0.10      0.02  0.01 (0.03)     
##       14          4       102 (0.82)          0.15      0.02  0.04 (0.03)     
##       15          4       106 (0.85)          0.17      0.02  0.05 (0.03) *   
##       16          2       108 (0.86)          0.11      0.02  0.03 (0.03)     
##       17          1       109 (0.87)          0.06      0.02  0.02 (0.03)     
##       18         16       125 (1.00)          1.00      0.02               -  
## -----------------------------------------------------------------------------
##  Left censoring  : 0.09 (11)
##  Right centoring : 0.00 (0)
##  # of nodes      : 125
## 
##  Moran's I was computed on contemporaneous autocorrelation using 1/geodesic
##  values. Significane levels  *** &lt;= .01, ** &lt;= .05, * &lt;= .1.</code></pre>
<p>And the ones included in the package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_diffnet.html">plot_diffnet</a></span>(diffnet, <span class="dt">slices=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">12</span>,<span class="dv">16</span>,<span class="dv">18</span>))</code></pre></div>
<p><img src="analyzing-medical-innovation-data_files/figure-html/graphs-1.png" width="600" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_threshold.html">plot_threshold</a></span>(diffnet, <span class="dt">undirected =</span> <span class="ot">FALSE</span>, <span class="dt">vertex.size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>)</code></pre></div>
<p><img src="analyzing-medical-innovation-data_files/figure-html/graphs-2.png" width="600" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_adopters.html">plot_adopters</a></span>(diffnet)</code></pre></div>
<p><img src="analyzing-medical-innovation-data_files/figure-html/graphs-3.png" width="600" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/hazard_rate.html">plot_hazard</a></span>(diffnet)</code></pre></div>
<p><img src="analyzing-medical-innovation-data_files/figure-html/graphs-4.png" width="600" style="display: block; margin: auto;"></p>
</div>
<div id="statistical-test" class="section level1">
<h1 class="hasAnchor">
<a href="#statistical-test" class="anchor"></a>Statistical test</h1>
<p>Now, we want to know if the threshold model fits here. In order to do so we will use the structure dependency test built in the package, <code>struct_test</code>. We will apply this both in a aggregated level and by city. First we need to subset the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get cities ids so we can subset the vertices and run the test by city.</span>
city &lt;-<span class="st"> </span>diffnet<span class="op">$</span>vertex.static.attrs[,<span class="st">"city"</span>]

<span class="co"># Subsetting diffnet, notice that we can use either indices or ids to create a</span>
<span class="co"># "subdiffnet". In this case we are using indices.</span>
diffnet_city1 &lt;-<span class="st"> </span>diffnet[<span class="kw">which</span>(city<span class="op">==</span><span class="dv">1</span>),]
diffnet_city2 &lt;-<span class="st"> </span>diffnet[<span class="kw">which</span>(city<span class="op">==</span><span class="dv">2</span>),]
diffnet_city3 &lt;-<span class="st"> </span>diffnet[<span class="kw">which</span>(city<span class="op">==</span><span class="dv">3</span>),]
diffnet_city4 &lt;-<span class="st"> </span>diffnet[<span class="kw">which</span>(city<span class="op">==</span><span class="dv">4</span>),]</code></pre></div>
<p>Notice that by subsetting the set of vertices we have created 4 new <code>diffnet</code> objects, so all the methods and functions work for each one of these, for example, threshold levels in each city</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">oldpar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">no.readonly =</span> <span class="ot">TRUE</span>)
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))
<span class="kw"><a href="../reference/plot_threshold.html">plot_threshold</a></span>(diffnet_city1, <span class="dt">vertex.label =</span> <span class="st">""</span>, <span class="dt">main=</span><span class="st">"Threshold and ToA</span><span class="ch">\n</span><span class="st">in City 1"</span>)
<span class="kw"><a href="../reference/plot_threshold.html">plot_threshold</a></span>(diffnet_city2, <span class="dt">vertex.label =</span> <span class="st">""</span>, <span class="dt">main=</span><span class="st">"Threshold and ToA</span><span class="ch">\n</span><span class="st">in City 2"</span>)
<span class="kw"><a href="../reference/plot_threshold.html">plot_threshold</a></span>(diffnet_city3, <span class="dt">vertex.label =</span> <span class="st">""</span>, <span class="dt">main=</span><span class="st">"Threshold and ToA</span><span class="ch">\n</span><span class="st">in City 3"</span>)
<span class="kw"><a href="../reference/plot_threshold.html">plot_threshold</a></span>(diffnet_city4, <span class="dt">vertex.label =</span> <span class="st">""</span>, <span class="dt">main=</span><span class="st">"Threshold and ToA</span><span class="ch">\n</span><span class="st">in City 4"</span>)</code></pre></div>
<p><img src="analyzing-medical-innovation-data_files/figure-html/Multithreshold-1.png" width="600" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(oldpar)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_infectsuscep.html">plot_infectsuscep</a></span>(diffnet_city1, <span class="dt">K=</span><span class="dv">5</span>, <span class="dt">logscale =</span> <span class="ot">TRUE</span>, <span class="dt">bins=</span><span class="dv">30</span>)</code></pre></div>
<pre><code>## Warning in plot_infectsuscep.list(graph$graph, graph$toa, t0, normalize, :
## When applying logscale some observations are missing.</code></pre>
<p><img src="analyzing-medical-innovation-data_files/figure-html/unnamed-chunk-2-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Now we run the test for each city. Observe that we can use the <strong>parallel</strong> package to speedup the test as we will do in the first two cities using two cores (this is done thanks to the <strong>boot</strong> package).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Defining the statistic</span>
avgthr &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">mean</span>(<span class="kw"><a href="../reference/threshold.html">threshold</a></span>(x), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)

<span class="co"># Running the test by city</span>
test1   &lt;-<span class="st"> </span><span class="kw"><a href="../reference/struct_test.html">struct_test</a></span>(diffnet_city1, avgthr, <span class="dv">500</span>, <span class="dt">ncpus=</span><span class="dv">2</span>, <span class="dt">parallel=</span><span class="st">"multicore"</span>)
test2   &lt;-<span class="st"> </span><span class="kw"><a href="../reference/struct_test.html">struct_test</a></span>(diffnet_city2, avgthr, <span class="dv">500</span>, <span class="dt">ncpus=</span><span class="dv">2</span>, <span class="dt">parallel=</span><span class="st">"multicore"</span>)
test3   &lt;-<span class="st"> </span><span class="kw"><a href="../reference/struct_test.html">struct_test</a></span>(diffnet_city3, avgthr, <span class="dv">500</span>)
test4   &lt;-<span class="st"> </span><span class="kw"><a href="../reference/struct_test.html">struct_test</a></span>(diffnet_city4, avgthr, <span class="dv">500</span>)

<span class="co"># Running the test aggregated</span>
testall &lt;-<span class="st"> </span><span class="kw"><a href="../reference/struct_test.html">struct_test</a></span>(diffnet, avgthr, <span class="dv">500</span>, <span class="dt">ncpus=</span><span class="dv">2</span>, <span class="dt">parallel=</span><span class="st">"multicore"</span>)

<span class="co"># Printing the outcomes</span>
test1</code></pre></div>
<pre><code>## 
## Structure dependence test
## # Simulations     : 500
## # nodes           : 62
## # of time periods : 18
## --------------------------------------------------------------------------------
##  H0: E[beta(Y,G)|G] - E[beta(Y,G)] = 0 (no structure dependency)
##     observed    expected       p.val
##       0.6304      0.6251      0.8000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test2</code></pre></div>
<pre><code>## 
## Structure dependence test
## # Simulations     : 500
## # nodes           : 24
## # of time periods : 18
## --------------------------------------------------------------------------------
##  H0: E[beta(Y,G)|G] - E[beta(Y,G)] = 0 (no structure dependency)
##     observed    expected       p.val
##       0.4931      0.5049      0.7960</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test3</code></pre></div>
<pre><code>## 
## Structure dependence test
## # Simulations     : 500
## # nodes           : 21
## # of time periods : 18
## --------------------------------------------------------------------------------
##  H0: E[beta(Y,G)|G] - E[beta(Y,G)] = 0 (no structure dependency)
##     observed    expected       p.val
##       0.4365      0.4198      0.6320</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test4</code></pre></div>
<pre><code>## 
## Structure dependence test
## # Simulations     : 500
## # nodes           : 18
## # of time periods : 18
## --------------------------------------------------------------------------------
##  H0: E[beta(Y,G)|G] - E[beta(Y,G)] = 0 (no structure dependency)
##     observed    expected       p.val
##       0.5926      0.6021      0.8120</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">testall</code></pre></div>
<pre><code>## 
## Structure dependence test
## # Simulations     : 500
## # nodes           : 125
## # of time periods : 18
## --------------------------------------------------------------------------------
##  H0: E[beta(Y,G)|G] - E[beta(Y,G)] = 0 (no structure dependency)
##     observed    expected       p.val
##       0.5660      0.5559      0.5760</code></pre>
<p>This shows in no City threshold seems to be struture dependent, as after simulating 1,000 networks by rewiring each one of these preserving the degree sequence (using <code>algorithm = "swap"</code> by default in the <code>rewire.args</code>) the null can’t be rejected. Now we can make an histogram of the outcomes by city:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># To make it nicer, we change the parameters in using par</span>
<span class="co"># (see ?par)</span>
oldpar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">no.readonly =</span> <span class="ot">TRUE</span>)
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))

<span class="co"># Now we use the hist method for the -diffnet_boot- class</span>
<span class="kw">hist</span>(test1, <span class="dt">main=</span><span class="st">"Distribution of Statistic on rewired</span><span class="ch">\n</span><span class="st">network (City 1)"</span>, <span class="dt">ask =</span> <span class="ot">FALSE</span>)
<span class="kw">hist</span>(test2, <span class="dt">main=</span><span class="st">"Distribution of Statistic on rewired</span><span class="ch">\n</span><span class="st">network (City 2)"</span>, <span class="dt">ask =</span> <span class="ot">FALSE</span>)
<span class="kw">hist</span>(test3, <span class="dt">main=</span><span class="st">"Distribution of Statistic on rewired</span><span class="ch">\n</span><span class="st">network (City 3)"</span>, <span class="dt">ask =</span> <span class="ot">FALSE</span>)
<span class="kw">hist</span>(test4, <span class="dt">main=</span><span class="st">"Distribution of Statistic on rewired</span><span class="ch">\n</span><span class="st">network (City 4)"</span>, <span class="dt">ask =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="analyzing-medical-innovation-data_files/figure-html/Histograms-1.png" width="600" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Returning to the previous graphical parameters</span>
<span class="kw">par</span>(oldpar)</code></pre></div>
</div>
<div id="retrieving-the-data-to-create-a-panelenvent-historylongitudinal-data" class="section level1">
<h1 class="hasAnchor">
<a href="#retrieving-the-data-to-create-a-panelenvent-historylongitudinal-data" class="anchor"></a>Retrieving the data to create a panel/envent history/longitudinal data</h1>
<p>To use the data for statistical models we can retrieve the data stored in the <code>diffnet</code> object and coerce it as a <code>data.frame</code>. First, we will compute <strong>lagged</strong> exposure at each time period and add it as a dynamic vertex attribute, including a dummy variable called <code>adopted</code> equal to 1 if the individual adopted at that time point.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Calculating lagged exposure</span>
expo &lt;-<span class="st"> </span><span class="kw"><a href="../reference/exposure.html">exposure</a></span>(diffnet, <span class="dt">lags =</span> 1L)
<span class="kw">head</span>(expo)</code></pre></div>
<pre><code>##       1 2         3         4         5         6         7         8
## 1001 NA 0 0.0000000 0.5000000 1.0000000 1.0000000 1.0000000 1.0000000
## 1002 NA 0 0.0000000 0.5000000 1.0000000 1.0000000 1.0000000 1.0000000
## 1003 NA 0 0.2000000 0.4000000 0.6000000 0.8000000 0.8000000 0.8000000
## 1004 NA 0 0.3333333 0.3333333 0.3333333 0.3333333 0.6666667 0.6666667
## 1005 NA 0 0.0000000 0.0000000 0.0000000 1.0000000 1.0000000 1.0000000
## 1006 NA 0 0.3333333 0.6666667 0.6666667 1.0000000 1.0000000 1.0000000
##              9        10        11        12        13        14        15
## 1001 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000
## 1002 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000
## 1003 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000
## 1004 0.6666667 0.6666667 0.6666667 0.6666667 0.6666667 0.6666667 0.6666667
## 1005 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000
## 1006 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000
##             16        17        18
## 1001 1.0000000 1.0000000 1.0000000
## 1002 1.0000000 1.0000000 1.0000000
## 1003 1.0000000 1.0000000 1.0000000
## 1004 0.6666667 0.6666667 0.6666667
## 1005 1.0000000 1.0000000 1.0000000
## 1006 1.0000000 1.0000000 1.0000000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Netdiffuser automatically identifies whether the input is dynamic or not.</span>
diffnet[[<span class="st">"lagged_expo"</span>]] &lt;-<span class="st"> </span>expo
diffnet[[<span class="st">"adopted"</span>]]  &lt;-<span class="st"> </span><span class="kw"><a href="../reference/toa_mat.html">toa_mat</a></span>(diffnet)<span class="op">$</span>cumadopt</code></pre></div>
<p>Now we can create a data frame from our <code>diffnet</code> object</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Getting the data</span>
mydata &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(diffnet)</code></pre></div>
<p>The following model illustrates how can we use netdiffuseR to run a lagged exposure model. In this (toy) model we are including fixed effects for time (<code>per</code>), <code>city</code>, belief in science (<code>belief</code>) and age, and only including observations prior to the adoption of the behavior, and excluding observations from the last time point.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Running a model</span>
<span class="kw">summary</span>(
  <span class="kw">glm</span>(adopted <span class="op">~</span><span class="st"> </span>lagged_expo <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(per) <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(city) <span class="op">+</span><span class="st"> </span>belief <span class="op">+</span><span class="st"> </span>
<span class="st">        </span>proage <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(proage<span class="op">^</span><span class="dv">2</span>),
      <span class="dt">dat    =</span> mydata, 
      <span class="dt">subset =</span> (per <span class="op">&lt;=</span><span class="st"> </span>toa) <span class="op">&amp;</span><span class="st"> </span>per <span class="op">&lt;</span><span class="st"> </span><span class="dv">18</span>,
      <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">"logit"</span>))
)</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = adopted ~ lagged_expo + factor(per) + factor(city) + 
##     belief + proage + I(proage^2), family = binomial(link = "logit"), 
##     data = mydata, subset = (per &lt;= toa) &amp; per &lt; 18)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.9291  -0.5547  -0.4294  -0.2990   2.6441  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   -4.86017    0.74267  -6.544 5.98e-11 ***
## lagged_expo    0.06835    0.36290   0.188  0.85060    
## factor(per)3   0.11026    0.49879   0.221  0.82505    
## factor(per)4   0.36896    0.49420   0.747  0.45532    
## factor(per)5   0.62556    0.49461   1.265  0.20595    
## factor(per)6   0.79024    0.51149   1.545  0.12235    
## factor(per)7   1.05813    0.52363   2.021  0.04331 *  
## factor(per)8   0.84961    0.57908   1.467  0.14232    
## factor(per)9   0.46900    0.67474   0.695  0.48700    
## factor(per)10 -0.89617    1.10056  -0.814  0.41548    
## factor(per)11  0.90279    0.64682   1.396  0.16280    
## factor(per)12  0.44730    0.74503   0.600  0.54826    
## factor(per)13  0.64460    0.75892   0.849  0.39567    
## factor(per)14  1.13806    0.71444   1.593  0.11117    
## factor(per)15  1.32137    0.72124   1.832  0.06694 .  
## factor(per)16  0.06475    1.12636   0.057  0.95416    
## factor(per)17  0.09697    1.12815   0.086  0.93150    
## factor(city)2 -0.05152    0.32958  -0.156  0.87579    
## factor(city)3 -0.07965    0.31878  -0.250  0.80270    
## factor(city)4 -0.19764    0.33718  -0.586  0.55777    
## belief         0.50842    0.16589   3.065  0.00218 ** 
## proage         0.94983    0.34181   2.779  0.00546 ** 
## I(proage^2)   -0.10620    0.04736  -2.242  0.02495 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 585.45  on 825  degrees of freedom
## Residual deviance: 548.47  on 803  degrees of freedom
##   (155 observations deleted due to missingness)
## AIC: 594.47
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>As shown, we find no lagged exposure effects and the adoption was mainly drive by belief in science and age of the MD. Notice that instead of calling <code>glm</code> directly, we could have also used the <code>diffreg</code> function (a wrapper of <code>glm</code> that does all the filtering and exposure computing for us) as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(
  <span class="kw"><a href="../reference/diffreg.html">diffreg</a></span>(diffnet <span class="op">~</span><span class="st"> </span>exposure <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(per) <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(city) <span class="op">+</span><span class="st"> </span>belief <span class="op">+</span><span class="st"> </span>
<span class="st">            </span>proage <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(proage<span class="op">^</span><span class="dv">2</span>))
  )</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Adopt ~ exposure + factor(per) + factor(city) + 
##     belief + proage + I(proage^2), family = binomial(link = "logit"), 
##     data = dat, subset = ifelse(is.na(toa), TRUE, toa &gt;= per))
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.9291  -0.5505  -0.4245  -0.2887   2.6441  
## 
## Coefficients:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -4.86017    0.74267  -6.544 5.98e-11 ***
## exposure        0.06835    0.36290   0.188  0.85060    
## factor(per)3    0.11026    0.49879   0.221  0.82505    
## factor(per)4    0.36896    0.49420   0.747  0.45532    
## factor(per)5    0.62556    0.49461   1.265  0.20595    
## factor(per)6    0.79024    0.51149   1.545  0.12235    
## factor(per)7    1.05813    0.52363   2.021  0.04331 *  
## factor(per)8    0.84961    0.57908   1.467  0.14232    
## factor(per)9    0.46900    0.67474   0.695  0.48700    
## factor(per)10  -0.89617    1.10058  -0.814  0.41549    
## factor(per)11   0.90279    0.64682   1.396  0.16280    
## factor(per)12   0.44730    0.74503   0.600  0.54826    
## factor(per)13   0.64460    0.75892   0.849  0.39567    
## factor(per)14   1.13806    0.71444   1.593  0.11117    
## factor(per)15   1.32137    0.72124   1.832  0.06694 .  
## factor(per)16   0.06475    1.12636   0.057  0.95416    
## factor(per)17   0.09697    1.12815   0.086  0.93150    
## factor(per)18  19.74176  584.21139   0.034  0.97304    
## factor(city)2  -0.05152    0.32958  -0.156  0.87579    
## factor(city)3  -0.07965    0.31878  -0.250  0.80270    
## factor(city)4  -0.19764    0.33718  -0.586  0.55777    
## belief          0.50842    0.16589   3.065  0.00218 ** 
## proage          0.94983    0.34181   2.779  0.00546 ** 
## I(proage^2)    -0.10620    0.04736  -2.242  0.02495 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 652.73  on 841  degrees of freedom
## Residual deviance: 548.47  on 818  degrees of freedom
##   (155 observations deleted due to missingness)
## AIC: 596.47
## 
## Number of Fisher Scoring iterations: 15</code></pre>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Note that there is a <code>diffnet</code> version of the same dataset in the package, <code>medInnovationsDiffNet</code>.<a href="#fnref1">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data-preprocessing">Data preprocessing</a></li>
      <li><a href="#methods">Methods</a></li>
      <li><a href="#statistical-test">Statistical test</a></li>
      <li><a href="#retrieving-the-data-to-create-a-panelenvent-historylongitudinal-data">Retrieving the data to create a panel/envent history/longitudinal data</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by George Vega Yon, Thomas Valente.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
